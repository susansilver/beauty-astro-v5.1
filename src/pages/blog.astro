---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseHead from "../components/base/BaseHead.astro";
import Header from "../components/base/Header.astro";
import Footer from "../components/base/Footer.astro";

const allPosts = (await getCollection("blog"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const categories = [
  ...new Set(allPosts.flatMap((blog) => blog.data.categories)),
];

const allTags = [
  ...new Set(allPosts.flatMap((blogPost) => blogPost.data.tags)),
];
---

<html lang="en">
  <head>
    <BaseHead title="Blog" description="The most current essays to read" />
  </head>
  <body class="bg-white-50">
    <Header />
    <div class="grid grid-cols-12 mt-10">
      <div class="col-span-10 col-start-2 col-end-11 lg:flex lg:flex-row mb-8">
        <div>Related tags:</div>
        <ul class="flex flex-row list-none flex-wrap">
          {
            allTags.map((tag) => {
              // Check if category is defined
              if (tag) {
                return (
                  <li class="m-3">
                    <a
                      class="tag"
                      href={`/tag/${tag}`}
                      title={`View posts tagged "${tag}"`}
                    >
                      #{tag.replace(/-/g, " ")}
                    </a>
                  </li>
                );
              }
              // Return null if category is not defined
              return null;
            })
          }
        </ul>
      </div>
      <div
        id="container"
        class="lg:flex lg:flex-wrap justify-center items-center col-span-10 col-start-2 col-end-11"
      >
        <!-- <ul class="list-none"> -->
        {
          allPosts.map((post) => (
            <>
              <div class="p-5 relative">
                <a
                  href={`/${post.slug}`}
                  class="no-underline text-black-900 visited:text-black-900 hover:text-secondary-900"
                >
                  <div class="relative lg:text-[1.563rem] xs">
                    <div class="wrap flex justify-center">
                      <Image
                        src={post.data.thumbnail}
                        alt={post.data.heroImage.alt}
                      />
                    </div>
                    <div class="absolute positioning text-balance text-primary-900 bg-white-50 p-1">
                      {post.data.title}
                    </div>
                  </div>
                </a>
              </div>
            </>
          ))
        }
        <!--  </ul> -->
      </div>
      <div
        class="col-span-10 col-start-2 col-end-11 flex lg:justify-center justify-end"
      >
        <button class="lg:w-full">View All ➤</button>
      </div>
    </div>
    <Footer />

    <style>
      .positioning {
        position: absolute;
        top: 60%; /* position the top  edge of the element at the middle of the parent */
        left: 60%; /* position the left edge of the element at the middle of the parent */

        transform: translate(
          -60%,
          -60%
        ); /* This is a shorthand of
                                         translateX(-50%) and translateY(-50%) */
      }

      .wrap {
        position: relative;
      }

      .wrap:after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /*  background: rgba(100, 181, 246, 0.75); */
      }
      /*  .wrap img {
        -webkit-filter: grayscale(100%);
        filter: grayscale(100%);
      } */

      #container > div:first-child {
        width: 100%;
      }

      /* @media screen and (max-width: 1280px) {
        #container > div:first-child {
          flex-basis: 7680px;
          max-width: fit-content;
        }
      }
 */
      @media screen and (min-width: 600px) {
        #container {
          max-width: fit-content;
          padding: 0 0;
        }
      }

      #container > div:first-child::after {
        position: absolute;
        content: "∯ New";
        background-color: #e0f2f1;
        filter: drop-shadow(#4db6ac 0.5em 0.5em 0);
        max-width: 15ch;
        /*  transform: translate(75%, -2ex);   */
        padding: 1.5em;
        bottom: 0;
        left: 60%;
        right: 0;
      }
      .tag {
        text-transform: capitalize;
        background-color: #f8bbd0;
        text-decoration: none;
        padding: 0.5em;
      }
    </style>
  </body>
</html>
